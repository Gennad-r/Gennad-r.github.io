function OtoCreateOrder(){$("#oto-btncreate").attr("disabled","disabled");$("#inputphone").val();$("#oto-cost").html("");var t=0;$(".maskoptionorders").each(function(){this.checked&&(t+=parseInt($(this).val()))});var e=[],r="s"==$("#inputstreetfrom").attr("alt")?$("#inputstreetfrom").attr("rel"):null,a="o"==$("#inputstreetfrom").attr("alt")?$("#inputstreetfrom").attr("rel"):null;e.push({StreetId:r,StreetName:$("#inputstreetfrom").val(),HouseId:$("#inputbuildfrom").attr("rel"),House:$("#inputbuildfrom").val(),ObjectId:a,Porch:$("#inputporchfrom").val()}),$(".streetto").each(function(t){var r="s"==$(this).find(".inputstreetto").attr("alt")?$(this).find(".inputstreetto").attr("rel"):null,a="o"==$(this).find(".inputstreetto").attr("alt")?$(this).find(".inputstreetto").attr("rel"):null;e.push({StreetId:r,StreetName:$(".inputstreetto").val(),HouseId:$(this).find(".inputbuildto").attr("rel"),House:$(this).find(".inputbuildto").val(),ObjectId:a,Porch:$(this).find(".inputporchto").val()})}),$(".addrdel").each(function(t){$(this).remove()}),phoneNumber=$("#inputphone").val();var o={Id:0,Latitude:0,Longitude:0,Area:"",GoodsNote:"",OrderRoutePoints:e,CarCount:0,ClientName:$("#username").val(),PhoneNumberLast:$("#inputphone1").val(),ExtraCost:$("#extracost").val(),City:CityName,CityTo:CityName,ClientId:PerfName,FormattedAddress:"String content",IsNoSpeak:!1,IsIntercity:!1,IsPreOrder:$("#oto-preorder").is(":checked"),DateSupply:$("#oto-preorder").is(":checked")?$("#dateto :selected").val()+" "+$("#hourto :selected").val()+":"+$("#mituteto :selected").val():"",Note:$("#inputdescription").val(),OrderOptionMask:t,PhoneNumber:$("#inputphone").val().replace(/[\+\-]/g,""),TaxiType:$("#taxitypeselect :selected").val(),TypeOrder:0,LoadSize:0,Weight:0,CarCount:$("#ColTaxi").val(),TariffId:$("#taxitariffselect :selected").val()};$.getJSON(url+"/CreateOrderWeb?callBack=?&value="+JSON.stringify(o),jsonpCreateOrder)}function jsonpCreateOrder(t){0==t.ErrorCode?(orderId=t.Context,$("#oto-btncreate").removeAttr("disabled"),$(".icon-div").hide(),$("#oto-btncancel").show(),$("#oto-btnneworder").hide(),$("input:text").attr("disabled","disabled"),$("select").attr("disabled","disabled"),$("#inputdescription").attr("disabled","disabled"),$("#addAdrTo").attr("disabled","disabled"),$("#getcost").attr("disabled","disabled"),$("#oto-preorder").attr("disabled","disabled"),$(".oto-div-params").hide(),$(".oto-div-status").show(),$(".panel-body").css("opacity",0),intervalID=setInterval(OtoStatusOrder,4e3)):($(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.msgErr[lang]))}function jsonpLoadStreet(t){if(data=t,0==data.ErrorCode)for(var e=0;e<data.Context.length;e++){var r={value:data.Context[e].Id,label:data.Context[e].Name,option:"s"};CityStreetObject.push(r)}}function jsonpLoadTariff(t){if(data=t,$("#taxitariffselect").empty(),0==data.ErrorCode){for(var e=0;e<data.Context.length;e++){data.Context[e].Id,data.Context[e].Name;$("#taxitariffselect").append("<option value='"+data.Context[e].Id+"'>"+data.Context[e].Name+"</option>")}0==data.Context.length&&$("#taxitariffselect").append("<option value='0'>"+txt.no[lang]+"</option>")}else $("#taxitariffselect").append("<option value='0'>"+txt.no[lang]+"</option>")}function jsonpLoadObject(t){if(data=t,0==data.ErrorCode)for(var e=0;e<data.Context.length;e++){var r={value:data.Context[e].Id,label:data.Context[e].Name+"*",option:"o"};CityStreetObject.push(r)}}function jsonpStatusOrder(t){if(0==t.ErrorCode){var e="";switch(t.Context.Status){case 1:e=txt.newOrder[lang];break;case 2:e=txt.goes[lang];break;case 3:e=txt.waitingr[lang];break;case 4:e=txt.notified[lang];break;case 5:e=txt.intransit[lang];break;case 6:e=txt.completed[lang];break;case 7:e=txt.canceled[lang];break;case 8:e=txt.late[lang];break;default:e=txt.notspecified[lang]}$(".statustext").text(e),$(".drivertext").text(t.Context.PerformerName),$(".taxitext").text(t.Context.TaxisModel+"  "+t.Context.TaxisNumber),$(".timetext").text(t.Context.DateComing),"0,00"==t.Context.Price?$(".costtext").text("  "+txt.tariff[lang]):$(".costtext").text("  "+t.Context.Price+" Cfa"),6==t.Context.Status&&(clearInterval(intervalID),$("#oto-btncancel").hide(),$("#oto-btnneworder").hide(),$("#oto-btnnew").show(),$(".oto-div-status").hide(),$(".oto-div-execute").show()),7==t.Context.Status&&(clearInterval(intervalID),$("#oto-btncancel").hide(),$("#oto-btnneworder").hide(),$("#oto-btnnew").show())}}function jsonpGetCost(t){0==t.ErrorCode?"0,00"==t.Context?$("#oto-cost").html(txt.cost[lang]+txt.tariff[lang]):$("#oto-cost").html(txt.cost[lang]+t.Context+" Cfa"):$("#oto-cost").html(t.Context)}function jsonpCancelOrder(t){if(0==t.ErrorCode){clearInterval(intervalID);var e="";switch(t.Context.Status){case 1:e=txt.newOrder[lang];break;case 2:e=txt.goes[lang];break;case 3:e=txt.waitingr[lang];break;case 4:e=txt.notified[lang];break;case 5:e=txt.intransit[lang];break;case 6:e=txt.completed[lang];break;case 7:e=txt.canceled[lang];break;case 8:e=txt.late[lang];break;default:e=txt.notspecified[lang]}$(".statustext").text(e),$(".drivertext").text(t.Context.PerformerName),$(".taxitext").text(t.Context.TaxisModel+"  "+t.Context.TaxisNumber),$(".timetext").text(t.Context.DateComing),$(".costtext").text(txt.from[lang]+t.Context.Price),orderId=0,$("#oto-btncreate").show(),$("#oto-btncancel").hide(),$("#oto-btnneworder").hide(),$("input:text").removeAttr("disabled"),$("input:text").val(""),$("select").removeAttr("disabled"),$("#inputdescription").val(""),$("#ColTaxi").val("1"),$("#oto-cost").html(""),$("#extracost").val("0"),$("input:checkbox").removeAttr("checked"),$("#inputdescription").removeAttr("disabled"),$("#oto-preorder").removeAttr("disabled"),$(".oto-div-params").show(),$(".oto-div-status").hide(),$(".oto-div-execute").hide(),$("#addAdrTo").removeAttr("disabled"),$("#getcost").removeAttr("disabled"),$(".statustext").html(""),$(".taxitext").html(""),$(".timetext").html(""),$(".costtext").html(""),$(".oto-div-predate").hide(),$("#oto-preorder").removeAttr("checked"),$("#taxitypeselect").val("63"),$(".addstreet").each(function(t){$(this).remove()})}}function OtoNewOrder(){document.location.reload(),$("#oto-btncreate").show(),$("#oto-btncancel").hide(),$("#oto-btnnew").hide(),$("input:text").removeAttr("disabled"),$("input:text").val(""),$("input:checkbox").removeAttr("checked"),$("select").removeAttr("disabled"),$("#inputdescription").val(""),$("#inputdescription").removeAttr("disabled"),$("#ColTaxi").val("1"),$("#extracost").val("0"),$("#oto-cost").html(""),$("#oto-preorder").removeAttr("disabled"),$(".oto-div-params").show(),$(".oto-div-status").hide(),$(".oto-div-execute").hide(),$("#addAdrTo").removeAttr("disabled"),$("#getcost").removeAttr("disabled"),$("#oto-btncreate").removeAttr("disabled"),$(".statustext").html(""),$(".taxitext").html(""),$(".timetext").html(""),$(".costtext").html(""),$(".oto-div-predate").hide(),$("#oto-preorder").removeAttr("checked"),$("#taxitypeselect").val("63"),$(".addstreet").each(function(t){$(this).remove()})}function OtoStatusOrder(){var t={PhoneNumber:phoneNumber,ClientId:"123",OrderId:orderId};$.getJSON(url+"/GetStatusOrderWeb?callBack=?&value="+JSON.stringify(t),jsonpStatusOrder)}function OtoCancelOrder(){var t={PhoneNumber:phoneNumber,ClientId:"123",OrderId:orderId};$.getJSON(url+"/CancelOrderWeb?callBack=?&value="+JSON.stringify(t),jsonpCancelOrder),document.location.reload()}function LoadStreet(){var t={OnlyHash:!1};$.getJSON(url+"/GetStreetCityWeb?callBack=?&value="+JSON.stringify(t),jsonpLoadStreet)}function LoadTariff(){var t={OnlyHash:!1};$.getJSON(url+"/GetTariffsWeb?callBack=?&value="+JSON.stringify(t),jsonpLoadTariff)}function LoadObject(){var t={OnlyHash:!1};$.getJSON(url+"/GetObjectCityWeb?callBack=?&value="+JSON.stringify(t),jsonpLoadObject)}function GetCost(){$("#inputphone").val();var t=1;if(""==$("#inputstreetfrom").val()&&(t=0),"s"==$("#inputstreetfrom").attr("alt")&&""!=$("#inputstreetfrom").val()&&""==$("#inputbuildfrom").val()&&(t=0),1==t){var e=0;$(".maskoptionorders").each(function(){this.checked&&(e+=parseInt($(this).val()))});var r=[],a="s"==$("#inputstreetfrom").attr("alt")?$("#inputstreetfrom").attr("rel"):null,o="o"==$("#inputstreetfrom").attr("alt")?$("#inputstreetfrom").attr("rel"):null;r.push({StreetId:a,HouseId:null,House:$("#inputbuildfrom").val(),ObjectId:o,Porch:$("#inputporchfrom").val()}),$(".streetto").each(function(t){if(""!=$(this).find(".inputstreetto").val()){var e="s"==$(this).find(".inputstreetto").attr("alt")?$(this).find(".inputstreetto").attr("rel"):null,a="o"==$(this).find(".inputstreetto").attr("alt")?$(this).find(".inputstreetto").attr("rel"):null;r.push({StreetId:e,HouseId:null,House:$(this).find(".inputbuildto").val(),ObjectId:a,Porch:$(this).find(".inputporchto").val()})}}),phoneNumber=$("#inputphone").val();var n={OrderRoutePoints:r,ClientId:PerfName,OrderOptions:e,PhoneNumber:$("#inputphone").val().replace(/[\+\-]/g,""),TariffId:$("#taxitariffselect :selected").val()};$.getJSON(url+"/GetPerfPriceWeb?callBack=?&value="+JSON.stringify(n),jsonpGetCost)}}function changePreorder(){if($("#oto-preorder").is(":checked")){var t=new Date;t=t.getHours()+1,$("#hourto [id='"+t+"']").attr("selected","selected"),$(".oto-div-predate").show()}else $(".oto-div-predate").hide()}function delpoint(t){$(t).parent().parent().remove(),$("#oto-cost").html("")}function addAddressTo(){$(".streetto").length<3?($("#oto-cost").html(""),$("#streetarray").append('<div class="streetto addstreet"><div class="oto-div-streetto"><span class="strtolable">'+txt.street[lang]+'</span><input class="inputstreetto autostreet"/> <b class="addrdel" style="color: red; cursor:pointer;" onclick="delpoint(this);">X</b></div><div class="oto-div-buildto div-build"><span class="buildtolable">'+txt.build[lang]+'</span><input class="inputbuildto" /></div><div class="oto-div-porchto"><span class="porchtolable">'+txt.porch[lang]+'</span><input class="inputporchto" /></div></div>'),$(".autostreet").autocomplete({minLength:3,source:CityStreetObject,_renderItem:function(t,e){return $("<li>").attr("data-value",e.value).append($("<a>").text(e.label)).appendTo(t)},focus:function(t,e){t.preventDefault(),$(this).attr("rel",e.item.value),$(this).attr("alt",e.item.option),$(this).val(e.item.label)},select:function(t,e){t.preventDefault(),$(this).attr("rel",e.item.value),$(this).attr("alt",e.item.option),$(this).val(e.item.label),"o"==e.item.option?($(this).parent().parent().find(".div-build input").attr("disabled","disabled"),$(this).parent().parent().find(".div-build input").val("")):($(this).parent().parent().find(".div-build input").val(""),$(this).parent().parent().find(".div-build input").removeAttr("disabled"),SetBuildInput($(this).parent().parent().find(".div-build input"),e.item.value))}})):($(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.limit[lang]))}function jsonpLoadBuild(t){if(0==t.ErrorCode){for(var e=[],r=0;r<t.Context.length;r++){var a={value:t.Context[r].Id,label:t.Context[r].Name};e.push(a)}$(currentBuilding).autocomplete({minLength:0,source:e,_renderItem:function(t,e){return $("<li>").attr("data-value",e.value).append($("<a>").text(e.label)).appendTo(t)},focus:function(t,e){t.preventDefault(),$(this).attr("rel",e.item.value),$(this).attr("alt",e.item.option),$(this).val(e.item.label)},select:function(t,e){t.preventDefault(),$(this).attr("rel",e.item.value),$(this).attr("alt",e.item.option),$(this).val(e.item.label)}}),$(currentBuilding).autocomplete("search",""),$(currentBuilding).focus()}}function SetBuildInput(t,e){currentBuilding=t;var t={StreetId:e};$.getJSON(url+"/GetBuildingsForCurrentStreetWeb?callBack=?&value="+JSON.stringify(t),jsonpLoadBuild)}function jsonpCheckClient(t){0==t.ErrorCode?t.Context.IsAuth?(OtoCreateOrder(),$(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(""),$(".oto-div-sms").hide()):($(".oto-div-sms").show(),$(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.sentSMS[lang]),$("#oto-btncreate").attr("disabled","disabled")):($(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(t.ErrorMessage))}function CheckClient(){var t=1;if(-1==$("#inputphone").val().replace(/\-/g,"").search(/^\+[0-9]{12}$/)?($(".panel-body").css("opacity",1),$("#inputphone").addClass("red"),$(".oto-div-error .panel-body").html(txt.phone[lang]),t=0):""==$("#username").val()?($("#inputphone").removeClass("red"),$(".oto-div-error .panel-body").html(txt.name[lang]),$("#username").addClass("red"),$(".panel-body").css("opacity",1),t=0):""==$("#inputstreetfrom").val()?($("#username").removeClass("red"),$("#inputstreetfrom").addClass("red"),$(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.address[lang]),t=0):"o"!=$("#inputstreetfrom").attr("alt")?""!=$("#inputstreetfrom").val()&&""==$("#inputbuildfrom").val()&&($("#inputbuildfrom").addClass("red"),$(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.buildPickup[lang]),t=0):$(".streetto").each(function(e){var r=$(this).find(".inputstreetto").val();if(""!=r){for(var a=0,o=0;o<CityStreetObject.length;o++)r==CityStreetObject[o].label&&(a=1);0==a&&($(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.waypoint[lang]),t=0)}}),1==t){$("#inputstreetfrom").removeClass("red"),$("#inputbuildfrom").removeClass("red");var e={PhoneNumber:$("#inputphone").val().replace(/[\+\-]/g,""),ClientId:PerfName};$.getJSON(url+"/CheckClientWeb?callBack=?&value="+JSON.stringify(e),jsonpCheckClient),ga("send",{hitType:"event",eventCategory:"order",eventAction:"send"})}}function jsonpCheckClientCode(t){0==t.ErrorCode?($(".panel-body").hide(),$(".oto-div-error .panel-body").html(""),$("#oto-btncreate").removeAttr("disabled"),$(".oto-div-sms").hide(),OtoCreateOrder()):($(".panel-body").css("opacity",1),$(".oto-div-error .panel-body").html(txt.left[lang]+t.Context+txt.attempts[lang]+t.ErrorMessage))}function CheckClientCode(){if(""!=$("#smsCode").val()){var t={PhoneNumber:$("#inputphone").val().replace(/[\+\-]/g,""),ClientId:PerfName,SmsCode:$("#smsCode").val()};$.getJSON(url+"/CheckClientCodeWeb?callBack=?&value="+JSON.stringify(t),jsonpCheckClientCode)}else $(".panel-body").css("opacity",1),$(".oto-div-error  .panel-body").html(txt.code[lang])}function createneworder(){return!!confirm(txt.confirm[lang])&&document.location.reload()}var txt={month:{en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sen","Oct","Nov","Dec"],ru:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],fr:["Jan","Fev","Mar","Avr","Mai","Juin","Juil","Aout","Sep","Oct","Nov","Dec"]},msgErr:{en:"Error. Try again.",ru:"При отправке произошла ошибка. Повторите попытку еще раз.",fr:"Erreur lors de l envoi, refaire svp."},no:{en:"No",ru:"нет",fr:"Non"},newOrder:{en:"New order",ru:"Новый заказ",fr:"Nouvelle commande"},goes:{en:"Goes to the client",ru:"Едет к клиенту",fr:"En route vers le client"},waiting:{en:"Waiting for client",ru:"Ждет клиента",fr:"En attente du client"},notified:{en:"Customer notified",ru:"Клиент оповещен",fr:"Client avert"},intransit:{en:"In transit",ru:"В пути",fr:"En rout"},completed:{en:"Completed",ru:"Выполнен",fr:"Realise"},canceled:{en:"Canceled",ru:"Отменен",fr:"Annule"},late:{en:"Late",ru:"Опаздывает",fr:"En retard"},notspecified:{en:"not specified",ru:"не указан",fr:"non defini"},tariff:{en:"by tariff",ru:"по тарифу",fr:"par tarif"},cost:{en:"Approximate cost of the trip: ",ru:"Примерная стоимость поездки: ",fr:"Prix approximatif du trajet: "},from:{en:" from ",ru:" от ",fr:" de "},street:{en:"Street",ru:"Улица",fr:"Rue"},build:{en:"Build",ru:"Дом",fr:"Maison"},porch:{en:"Porch",ru:"Подъезд",fr:"Entree"},limit:{en:"The limit of the number of waypoints has been reached!",ru:"Достигнут предел количества точек пути!",fr:"Surplus sur le nombre du trajet!"},sentSMS:{en:"Your SMS has been sent to your phone with authorization code!",ru:"На Ваш телефон отправлена СМС с кодом для авторизации!",fr:"SMS envoye sur votre telephone avec code de denarrage!"},phone:{en:"Enter the correct phone number!",ru:"Введите правильно телефон!",fr:"Inserer le numero correct!"},name:{en:"Enter your name!",ru:"Введите имя!",fr:"Entrez le nom!"},address:{en:"Specify the pick-up address!",ru:"Укажите адрес подачи!",fr:"Definissez ladresse d envoi!"},buildPickup:{en:"Indicate the house in the pick-up address!",ru:"Укажите дом в адресе подачи!",fr:"Definissez l adresse de la maison!"},waypoint:{en:"Enter the correct waypoint!",ru:"Введите правильно точку маршрута!",fr:"Definer le trajet!"},left:{en:"You have ",ru:"У Вас осталось ",fr:"Il vous reste "},attempts:{en:" attempts!",ru:" попыток!",fr:" essais!"},code:{en:"Enter the code from the SMS!",ru:"Введите код из СМС!",fr:"Entrer le code SMS!"},confirm:{en:"When creating a new order, the information about current order status will be unavailable. Are you sure you want to create a new order?",ru:"При создании нового заказа информация о статусе текущего заказа, а так же его отмена станет недоступна. Вы подтверждаете создание нового заказа?",fr:"Au cours de la nouvelle commande, l information sur son statut et son annulation reste inacessible. Vous confirmez la nouvelle commande?"}},lang=$("html")[0].lang,MonthNames=txt.month[lang],CityName="Dakar",PerfName=$.guid++,url="http://154.124.46.37:17005/MobileClientApiJson.svc",CityStreetObject=[],intervalID,phoneNumber="",orderId=0,currentBuilding={};$(function(){LoadStreet(),LoadObject(),LoadTariff(),$("#oto-btncreate").click(CheckClient),$("#oto-btnsms").click(CheckClientCode),$("#oto-btncancel").click(OtoCancelOrder),$("#oto-btnnew").click(OtoNewOrder),$("#inputtime").mask("99:99"),$("#inputphone").mask("+221-000-000-000"),$("#inputphone1").mask("+221-000-000-000");for(t=0;t<24;t++)$("#hourto").append($("<option>",{id:1==String(t).length?""+t:t,value:1==String(t).length?"0"+t:t,text:1==String(t).length?"0"+t:t}));for(var t=0;t<6;t++)$("#mituteto").append($("<option>",{value:1==String(10*t).length?"0"+t:10*t,text:1==String(10*t).length?"0"+t:10*t}));var e=new Date,r=new Date;r.setDate(e.getDate()+1),$("#dateto").append($("<option>",{value:e.getFullYear()+"-"+(1==String(e.getMonth()+1).length?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(1==String(e.getDate()).length?"0"+e.getDate():e.getDate()),text:(1==String(e.getDate()).length?"0"+e.getDate():e.getDate())+"-"+MonthNames[e.getMonth()]+"-"+e.getFullYear()})),$("#dateto").append($("<option>",{value:r.getFullYear()+"-"+(1==String(r.getMonth()+1).length?"0"+(r.getMonth()+1):r.getMonth()+1)+"-"+(1==String(r.getDate()).length?"0"+r.getDate():r.getDate()),text:(1==String(r.getDate()).length?"0"+r.getDate():r.getDate())+"-"+MonthNames[r.getMonth()]+"-"+r.getFullYear()})),$(".autostreet").autocomplete({minLength:3,source:CityStreetObject,_renderItem:function(t,e){return $("<li>").attr("data-value",e.value).append($("<a>").text(e.label)).appendTo(t)},focus:function(t,e){t.preventDefault(),$(this).attr("rel",e.item.value),$(this).attr("alt",e.item.option),$(this).val(e.item.label)},select:function(t,e){t.preventDefault(),$(this).attr("rel",e.item.value),$(this).attr("alt",e.item.option),$(this).val(e.item.label),"o"==e.item.option?($(this).parent().parent().find(".div-build input").attr("disabled","disabled"),$(this).parent().parent().find(".div-build input").val("")):($(this).parent().parent().find(".div-build input").val(""),$(this).parent().parent().find(".div-build input").removeAttr("disabled"),SetBuildInput($(this).parent().parent().find(".div-build input"),e.item.value))}})});